no aaa root
!
username admin privilege 15 role network-admin secret sha512 $6$VMQurCeojY9yg9Xa$CiOcLSn3EUjQxaRwi5PKvQYYhOlGmk17avGVxu46y3jYqHouDInHaVNQJY.xUb.ma15oph1eGKvFhDkps7m/A/
!
service routing protocols model multi-agent
!
hostname {{ .ShortName }}
!
spanning-tree mode mstp
!
system l1
   unsupported speed action error
   unsupported error-correction action error
!
{{- if .Env.CLAB_MGMT_VRF }}
!
vrf instance {{ .Env.CLAB_MGMT_VRF }}
{{end}}
!
ip name-server {{ if .Env.CLAB_MGMT_VRF }}vrf {{ .Env.CLAB_MGMT_VRF }}{{end}} 8.8.8.8
{{ if .Env.CVADDR }}
!
daemon TerminAttr
   exec /usr/bin/TerminAttr -cvaddr={{ .Env.CVADDR }} -cvauth=token-secure,/mnt/flash/cv-onboarding-token {{ if .Env.CLAB_MGMT_VRF }}-cvvrf={{ .Env.CLAB_MGMT_VRF }}{{end}} -disableaaa -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -taillogs
   no shutdown
{{ end }}
!
ntp local-interface {{ if .Env.CLAB_MGMT_VRF }}vrf {{ .Env.CLAB_MGMT_VRF }}{{end}} {{ .MgmtIntf }}
ntp server {{ if .Env.CLAB_MGMT_VRF }}vrf {{ .Env.CLAB_MGMT_VRF }}{{end}} 0.pool.ntp.org prefer
!
interface {{ .MgmtIntf }}
   description oob_management
   no shutdown
   {{ if .Env.CLAB_MGMT_VRF }}vrf {{ .Env.CLAB_MGMT_VRF }}{{end}}
   {{ if .MgmtIPv4Address }}ip address {{ .MgmtIPv4Address }}/{{.MgmtIPv4PrefixLength}}{{end}}
   {{ if .MgmtIPv6Address }}ipv6 address {{ .MgmtIPv6Address }}/{{.MgmtIPv6PrefixLength}}{{end}}
   no lldp receive
   no lldp transmit
!
{{ if .MgmtIPv4Gateway }}ip route {{ if .Env.CLAB_MGMT_VRF }}vrf {{ .Env.CLAB_MGMT_VRF }} {{end}}0.0.0.0/0 {{ .MgmtIPv4Gateway }}{{end}}
{{ if .MgmtIPv6Gateway }}ipv6 route {{ if .Env.CLAB_MGMT_VRF }}vrf {{ .Env.CLAB_MGMT_VRF }} {{end}}::0/0 {{ .MgmtIPv6Gateway }}{{end}}
!
management api http-commands
   protocol https
   no shutdown
   !
{{- if .Env.CLAB_MGMT_VRF }}
   vrf {{ .Env.CLAB_MGMT_VRF }}
      no shutdown
{{end}}
!
management api gnmi
   transport grpc default
!
management api netconf
   transport ssh default
!
ip routing
!
end